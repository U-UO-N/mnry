# 实现计划：电商小程序平台

## 概述

本实现计划将设计文档转化为可执行的开发任务，采用渐进式开发策略，优先实现核心购物流程，再扩展营销和管理功能。

## 任务列表

- [x] 1. 项目初始化与基础架构搭建
  - [x] 1.1 初始化后端项目结构
    - 创建 Node.js + Express 项目
    - 配置 TypeScript、ESLint、Prettier
    - 设置目录结构：controllers、services、models、routes、middlewares
    - _需求: 全局_

  - [x] 1.2 配置数据库连接
    - 配置 MySQL 连接池
    - 配置 Redis 客户端
    - 创建数据库迁移脚本
    - _需求: 全局_

  - [x] 1.3 实现基础中间件
    - 实现请求日志中间件
    - 实现错误处理中间件
    - 实现 JWT 认证中间件
    - _需求: 全局_

  - [x] 1.4 编写基础中间件单元测试
    - 测试错误处理中间件
    - 测试认证中间件
    - _需求: 全局_

- [x] 2. 用户服务实现
  - [x] 2.1 实现用户数据模型
    - 创建 users 表迁移脚本
    - 实现 User 模型类
    - _需求: 9.1_

  - [x] 2.2 实现微信登录接口
    - 实现 code2session 调用
    - 实现用户创建/更新逻辑
    - 实现 JWT token 生成
    - _需求: 9.1_

  - [x] 2.3 实现用户信息接口
    - GET /api/user/info - 获取用户信息
    - PUT /api/user/info - 更新用户信息
    - _需求: 9.1, 9.2_

  - [x] 2.4 编写用户服务属性测试
    - **属性 12: 用户资产数据一致性**
    - **验证需求: 7.1**

- [x] 3. 商品服务实现
  - [x] 3.1 实现商品数据模型
    - 创建 products、product_skus、categories 表迁移脚本
    - 实现 Product、ProductSKU、Category 模型类
    - _需求: 2.1, 4.1_

  - [x] 3.2 实现分类接口
    - GET /api/categories - 获取一级分类列表
    - GET /api/categories/:id/children - 获取子分类
    - _需求: 2.1, 2.2_

  - [x] 3.3 编写分类层级属性测试
    - **属性 2: 分类层级一致性**
    - **验证需求: 2.2, 2.3**

  - [x] 3.4 实现商品列表接口
    - GET /api/products - 商品列表（支持分类筛选、分页）
    - GET /api/products/:id - 商品详情
    - _需求: 2.3, 2.4, 4.1, 4.2_

  - [x] 3.5 编写商品详情属性测试
    - **属性 5: 商品详情数据完整性**
    - **验证需求: 4.1, 4.2**

  - [x] 3.6 实现商品搜索接口
    - GET /api/products/search - 关键词搜索
    - _需求: 1.4_

  - [x] 3.7 编写搜索结果属性测试
    - **属性 1: 搜索结果相关性**
    - **验证需求: 1.4**

- [x] 4. 首页配置服务实现
  - [x] 4.1 实现首页配置数据模型
    - 创建 banners、home_hot_products、category_shortcuts 表
    - 实现对应模型类
    - _需求: 1.1, 1.2, 1.3_

  - [x] 4.2 实现首页数据接口
    - GET /api/home/banners - 轮播图
    - GET /api/home/hot-products - 热门商品
    - GET /api/home/category-shortcuts - 分类快捷入口
    - _需求: 1.1, 1.2, 1.3_

- [x] 5. 检查点 - 基础服务验证
  - 确保所有测试通过，如有问题请咨询用户

- [x] 6. 购物车服务实现
  - [x] 6.1 实现购物车数据模型
    - 创建 cart_items 表迁移脚本
    - 实现 CartItem 模型类
    - _需求: 3.1_

  - [x] 6.2 实现购物车接口
    - GET /api/cart - 获取购物车列表
    - POST /api/cart - 添加商品到购物车
    - PUT /api/cart/:id - 更新商品数量
    - DELETE /api/cart/:id - 删除购物车商品
    - GET /api/cart/count - 获取购物车商品数量
    - _需求: 3.1, 3.2, 3.3, 4.3, 12.3_

  - [x] 6.3 编写购物车价格计算属性测试
    - **属性 3: 购物车价格计算正确性**
    - **验证需求: 3.1, 3.2**

  - [x] 6.4 编写购物车操作属性测试
    - **属性 4: 购物车操作一致性**
    - **验证需求: 3.3, 4.3**

  - [x] 6.5 编写购物车角标属性测试
    - **属性 24: 购物车角标数量正确性**
    - **验证需求: 12.3**

- [x] 7. 订单服务实现
  - [x] 7.1 实现订单数据模型
    - 创建 orders、order_items、logistics 表迁移脚本
    - 实现 Order、OrderItem 模型类
    - _需求: 5.1_

  - [x] 7.2 实现订单创建接口
    - POST /api/orders - 创建订单
    - 实现库存扣减逻辑
    - 实现优惠计算逻辑
    - _需求: 7.5_

  - [x] 7.3 编写订单抵扣计算属性测试
    - **属性 14: 订单抵扣计算正确性**
    - **验证需求: 7.5**

  - [x] 7.4 实现订单查询接口
    - GET /api/orders - 订单列表（支持状态筛选）
    - GET /api/orders/:id - 订单详情
    - _需求: 5.1, 5.2, 5.6_

  - [x] 7.5 编写订单状态筛选属性测试
    - **属性 6: 订单状态筛选正确性**
    - **验证需求: 5.2**

  - [x] 7.6 编写订单详情属性测试
    - **属性 8: 订单详情数据完整性**
    - **验证需求: 5.6**

  - [x] 7.7 实现订单操作接口
    - POST /api/orders/:id/cancel - 取消订单
    - POST /api/orders/:id/confirm - 确认收货
    - POST /api/orders/:id/refund - 申请售后
    - _需求: 5.3, 5.4, 5.5_

  - [x] 7.8 编写订单状态操作属性测试
    - **属性 7: 订单状态操作权限**
    - **验证需求: 5.3, 5.4, 5.5**

- [x] 8. 检查点 - 核心购物流程验证
  - 确保所有测试通过，如有问题请咨询用户

- [x] 9. 支付服务实现
  - [x] 9.1 实现支付数据模型
    - 创建 payments、refunds 表迁移脚本
    - 实现 Payment 模型类
    - _需求: 5.3_

  - [x] 9.2 实现微信支付接口
    - POST /api/payments - 创建支付
    - POST /api/payments/callback - 支付回调
    - _需求: 5.3_

  - [x] 9.3 实现退款接口
    - POST /api/refunds - 申请退款
    - _需求: 5.5_

- [x] 10. 拼团服务实现
  - [x] 10.1 实现拼团数据模型
    - 创建 group_buy_activities、group_buy_groups、group_buy_orders 表
    - 实现对应模型类
    - _需求: 6.1_

  - [x] 10.2 实现拼团活动接口
    - GET /api/group-buy/activities - 拼团活动列表
    - GET /api/group-buy/activities/:id - 拼团活动详情
    - _需求: 6.1_

  - [x] 10.3 编写拼团价格属性测试
    - **属性 9: 拼团价格展示正确性**
    - **验证需求: 6.1**

  - [x] 10.4 实现拼团操作接口
    - POST /api/group-buy/initiate - 发起拼团
    - POST /api/group-buy/join/:groupId - 参与拼团
    - GET /api/group-buy/my - 我的拼团列表
    - _需求: 6.2, 6.3, 6.6_

  - [x] 10.5 编写拼团人数属性测试
    - **属性 10: 拼团人数计数正确性**
    - **验证需求: 6.3, 6.4**

  - [x] 10.6 实现拼团定时任务
    - 实现拼团超时检查任务
    - 实现自动退款逻辑
    - _需求: 6.4, 6.5_

  - [x] 10.7 编写拼团超时属性测试
    - **属性 11: 拼团超时处理正确性**
    - **验证需求: 6.5**

- [x] 11. 会员权益服务实现
  - [x] 11.1 实现权益数据模型
    - 创建 coupons、user_coupons、points_records、balance_records 表
    - 实现对应模型类
    - _需求: 7.1_

  - [x] 11.2 实现余额接口
    - GET /api/user/balance - 余额信息
    - GET /api/user/balance/records - 余额明细
    - _需求: 7.1, 7.2_

  - [x] 11.3 实现积分接口
    - GET /api/user/points - 积分信息
    - GET /api/user/points/records - 积分明细
    - _需求: 7.1, 7.3_

  - [x] 11.4 实现优惠券接口
    - GET /api/user/coupons - 优惠券列表（支持状态筛选）
    - _需求: 7.4_

  - [x] 11.5 编写优惠券状态属性测试
    - **属性 13: 优惠券状态分类正确性**
    - **验证需求: 7.4**

- [x] 12. 签到与兑换服务实现
  - [x] 12.1 实现签到数据模型
    - 创建 check_ins 表迁移脚本
    - 实现 CheckIn 模型类
    - _需求: 8.1_

  - [x] 12.2 实现签到接口
    - GET /api/check-in/status - 签到状态
    - POST /api/check-in - 执行签到
    - _需求: 8.1, 8.2, 8.3_

  - [x] 12.3 编写签到积分属性测试
    - **属性 15: 签到积分增加正确性**
    - **验证需求: 8.2**

  - [x] 12.4 编写签到幂等性属性测试
    - **属性 16: 签到幂等性**
    - **验证需求: 8.3**

  - [x] 12.5 实现兑换中心接口
    - GET /api/exchange/items - 可兑换商品列表
    - POST /api/exchange - 执行兑换
    - _需求: 8.4, 8.5_

  - [x] 12.6 编写积分兑换属性测试
    - **属性 17: 积分兑换正确性**
    - **验证需求: 8.5**

- [x] 13. 检查点 - 会员权益验证
  - 确保所有测试通过，如有问题请咨询用户

- [x] 14. 用户行为记录服务实现
  - [x] 14.1 实现收藏与浏览数据模型
    - 创建 favorites、browse_history 表
    - 实现对应模型类
    - _需求: 9.3, 9.4_

  - [x] 14.2 实现收藏接口
    - GET /api/user/favorites - 收藏列表
    - POST /api/user/favorites - 添加收藏
    - DELETE /api/user/favorites/:productId - 取消收藏
    - _需求: 9.3_

  - [x] 14.3 编写收藏列表属性测试
    - **属性 18: 收藏列表一致性**
    - **验证需求: 9.3**

  - [x] 14.4 实现浏览记录接口
    - GET /api/user/browse-history - 浏览记录
    - POST /api/user/browse-history - 记录浏览
    - _需求: 9.4_

  - [x] 14.5 编写浏览记录属性测试
    - **属性 19: 浏览记录正确性**
    - **验证需求: 9.4**

  - [x] 14.6 实现评论接口
    - GET /api/user/reviews - 我的评论
    - POST /api/orders/:id/review - 发表评论
    - _需求: 9.5, 5.5_

- [x] 15. 分销服务实现
  - [x] 15.1 实现分销数据模型
    - 创建 commissions、withdrawals 表
    - 实现对应模型类
    - _需求: 10.1_

  - [x] 15.2 实现收益接口
    - GET /api/user/income - 收益概览
    - GET /api/user/income/records - 收益明细
    - _需求: 10.1, 10.2_

  - [x] 15.3 编写分销收益属性测试
    - **属性 20: 分销收益计算正确性**
    - **验证需求: 10.1, 10.2**

  - [x] 15.4 实现提现接口
    - POST /api/user/withdraw - 申请提现
    - _需求: 10.3_

  - [x] 15.5 编写提现金额属性测试
    - **属性 21: 提现金额校验正确性**
    - **验证需求: 10.3**

  - [x] 15.6 实现分享链接接口
    - GET /api/share/:productId - 生成分享链接
    - _需求: 10.4_

  - [x] 15.7 编写分享链接属性测试
    - **属性 22: 分享链接推广标识正确性**
    - **验证需求: 10.4**

- [x] 16. B端合作方服务实现
  - [x] 16.1 实现合作方数据模型
    - 创建 merchant_applications 表
    - 实现对应模型类
    - _需求: 11.1, 11.2_

  - [x] 16.2 实现申请接口
    - POST /api/merchant/apply/store - 门店申请
    - POST /api/merchant/apply/supplier - 供应商申请
    - GET /api/merchant/application/status - 申请状态
    - _需求: 11.1, 11.2, 11.3_

  - [x] 16.3 编写合作方申请属性测试
    - **属性 23: 合作方申请状态流转正确性**
    - **验证需求: 11.3, 11.4**

- [x] 17. 检查点 - 小程序端功能验证
  - 确保所有测试通过，如有问题请咨询用户


- [x] 18. 管理后台 - 商品管理实现
  - [x] 18.1 实现商品管理接口
    - GET /api/admin/products - 商品列表（支持搜索、筛选、分页）
    - POST /api/admin/products - 新增商品
    - PUT /api/admin/products/:id - 编辑商品
    - PUT /api/admin/products/:id/status - 上架/下架
    - DELETE /api/admin/products/:id - 删除商品
    - _需求: 13.1, 13.2, 13.3, 13.4, 13.5, 13.6, 13.7_

  - [x] 18.2 编写商品持久化属性测试
    - **属性 25: 商品数据持久化正确性**
    - **验证需求: 13.3, 13.7**

  - [x] 18.3 编写商品状态属性测试
    - **属性 26: 商品状态变更正确性**
    - **验证需求: 13.6**

- [x] 19. 管理后台 - 分类管理实现
  - [x] 19.1 实现分类管理接口
    - GET /api/admin/categories - 分类树
    - POST /api/admin/categories - 新增分类
    - PUT /api/admin/categories/:id - 编辑分类
    - DELETE /api/admin/categories/:id - 删除分类
    - _需求: 14.1, 14.2, 14.3, 14.4, 14.5_

  - [x] 19.2 编写分类删除约束属性测试
    - **属性 27: 分类删除约束正确性**
    - **验证需求: 14.5**

- [x] 20. 管理后台 - 首页配置实现
  - [x] 20.1 实现首页配置接口
    - GET /api/admin/home/config - 获取首页配置
    - PUT /api/admin/home/banners - 配置轮播图
    - PUT /api/admin/home/hot-products - 配置热门商品
    - PUT /api/admin/home/category-shortcuts - 配置分类入口
    - _需求: 15.1, 15.2, 15.3, 15.4, 15.5_

  - [x] 20.2 编写首页配置同步属性测试
    - **属性 28: 首页配置同步正确性**
    - **验证需求: 15.2, 15.3, 15.4, 15.5**

- [x] 21. 管理后台 - 订单管理实现
  - [x] 21.1 实现订单管理接口
    - GET /api/admin/orders - 订单列表（支持筛选）
    - GET /api/admin/orders/:id - 订单详情
    - POST /api/admin/orders/:id/ship - 发货
    - POST /api/admin/orders/:id/refund - 处理售后
    - _需求: 16.1, 16.2, 16.3, 16.4_

  - [x] 21.2 编写订单发货属性测试
    - **属性 29: 订单发货状态流转正确性**
    - **验证需求: 16.3**

- [x] 22. 管理后台 - 资金管理实现
  - [x] 22.1 实现资金管理接口
    - GET /api/admin/finance/overview - 资金概览
    - GET /api/admin/finance/transactions - 交易流水
    - GET /api/admin/finance/withdrawals - 提现申请列表
    - POST /api/admin/finance/withdrawals/:id/process - 处理提现
    - GET /api/admin/finance/commissions - 分销佣金明细
    - _需求: 17.1, 17.2, 17.3, 17.4_

  - [x] 22.2 编写资金统计属性测试
    - **属性 30: 资金统计正确性**
    - **验证需求: 17.1**

- [x] 23. 管理后台 - 用户管理实现
  - [x] 23.1 实现用户管理接口
    - GET /api/admin/users - 用户列表
    - GET /api/admin/users/:id - 用户详情
    - PUT /api/admin/users/:id/points - 调整积分
    - PUT /api/admin/users/:id/balance - 调整余额
    - GET /api/admin/merchant/applications - 合作方申请列表
    - POST /api/admin/merchant/applications/:id/review - 审核申请
    - _需求: 18.1, 18.2, 18.3, 18.4_

  - [x] 23.2 编写积分余额调整属性测试
    - **属性 31: 用户积分/余额调整日志正确性**
    - **验证需求: 18.3**

- [x] 24. 管理后台 - 营销活动管理实现
  - [x] 24.1 实现拼团管理接口
    - GET /api/admin/group-buy/activities - 拼团活动列表
    - POST /api/admin/group-buy/activities - 创建拼团活动
    - PUT /api/admin/group-buy/activities/:id - 编辑拼团活动
    - GET /api/admin/group-buy/activities/:id/stats - 拼团数据统计
    - _需求: 19.1, 19.2, 19.3, 19.4_

  - [x] 24.2 编写拼团活动持久化属性测试
    - **属性 32: 拼团活动数据持久化正确性**
    - **验证需求: 19.2, 19.3**

  - [x] 24.3 编写拼团统计属性测试
    - **属性 33: 拼团统计数据正确性**
    - **验证需求: 19.4**

- [x] 25. 管理后台 - 素材中心实现
  - [x] 25.1 实现素材管理接口
    - GET /api/admin/materials - 素材列表
    - POST /api/admin/materials - 上传素材
    - DELETE /api/admin/materials/:id - 删除素材
    - _需求: 20.1, 20.2, 20.3_

  - [x] 25.2 编写素材删除属性测试
    - **属性 34: 素材删除正确性**
    - **验证需求: 20.3**

- [x] 26. 检查点 - 管理后台功能验证
  - 确保所有测试通过，如有问题请咨询用户

- [x] 27. 小程序前端开发
  - [x] 27.1 初始化小程序项目
    - 创建 uni-app 项目
    - 配置项目结构和基础样式
    - 配置 API 请求封装
    - _需求: 全局_

  - [x] 27.2 实现首页模块
    - 轮播图组件
    - 热门商品列表
    - 分类快捷入口
    - 搜索功能
    - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

  - [x] 27.3 实现分类模块
    - 一级分类列表
    - 二级分类列表
    - 商品列表（分页加载）
    - _需求: 2.1, 2.2, 2.3, 2.4_

  - [x] 27.4 实现商品详情模块
    - 商品图片轮播
    - 规格选择
    - 加入购物车/立即购买
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

  - [x] 27.5 实现购物车模块
    - 购物车列表
    - 数量修改/删除
    - 结算功能
    - 空状态处理
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

  - [x] 27.6 实现订单模块
    - 订单确认页
    - 订单列表（tab切换）
    - 订单详情
    - 订单操作（支付/取消/确认收货/售后）
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

  - [x] 27.7 实现拼团模块
    - 拼团商品详情
    - 发起/参与拼团
    - 我的拼团列表
    - _需求: 6.1, 6.2, 6.3, 6.6_

  - [x] 27.8 实现个人中心模块
    - 用户信息展示
    - 资产展示（余额/积分/优惠券）
    - 功能入口列表
    - _需求: 9.1, 7.1_

  - [x] 27.9 实现会员权益模块
    - 余额明细
    - 积分明细
    - 优惠券列表
    - 签到页面
    - 兑换中心
    - _需求: 7.2, 7.3, 7.4, 8.1, 8.2, 8.3, 8.4, 8.5_

  - [x] 27.10 实现用户行为模块
    - 收藏列表
    - 浏览记录
    - 我的评论
    - _需求: 9.3, 9.4, 9.5_

  - [x] 27.11 实现分销模块
    - 收益页面
    - 提现功能
    - 分享功能
    - _需求: 10.1, 10.2, 10.3, 10.4_

  - [x] 27.12 实现B端入口模块
    - 门店申请表单
    - 供应商申请表单
    - _需求: 11.1, 11.2, 11.3_

  - [x] 27.13 实现底部导航
    - TabBar 配置
    - 购物车角标
    - _需求: 12.1, 12.2, 12.3_

- [x] 28. 管理后台前端开发
  - [x] 28.1 初始化管理后台项目
    - 创建 Vue 3 + Element Plus 项目
    - 配置路由和状态管理
    - 配置 API 请求封装
    - _需求: 全局_

  - [x] 28.2 实现商品管理页面
    - 商品列表（搜索/筛选/分页）
    - 商品编辑表单（参照淘宝模板）
    - 图片上传组件
    - 规格/SKU 编辑
    - _需求: 13.1, 13.2, 13.3, 13.4, 13.5, 13.6, 13.7_

  - [x] 28.3 实现分类管理页面
    - 分类树展示
    - 分类增删改
    - _需求: 14.1, 14.2, 14.3, 14.4, 14.5_

  - [x] 28.4 实现首页配置页面
    - 轮播图配置
    - 热门商品配置
    - 分类入口配置
    - _需求: 15.1, 15.2, 15.3, 15.4, 15.5_

  - [x] 28.5 实现订单管理页面
    - 订单列表（筛选）
    - 订单详情
    - 发货操作
    - 售后处理
    - _需求: 16.1, 16.2, 16.3, 16.4_

  - [x] 28.6 实现资金管理页面
    - 资金概览
    - 交易流水
    - 提现审核
    - 佣金明细
    - _需求: 17.1, 17.2, 17.3, 17.4_

  - [x] 28.7 实现用户管理页面
    - 用户列表
    - 用户详情
    - 积分/余额调整
    - 合作方审核
    - _需求: 18.1, 18.2, 18.3, 18.4_

  - [x] 28.8 实现营销管理页面
    - 拼团活动列表
    - 拼团活动编辑
    - 拼团数据统计
    - _需求: 19.1, 19.2, 19.3, 19.4_

  - [x] 28.9 实现素材中心页面
    - 素材列表
    - 素材上传
    - _需求: 20.1, 20.2, 20.3_

- [x] 29. 最终检查点 - 全功能验证
  - 确保所有测试通过
  - 验证前后端集成
  - 如有问题请咨询用户

## 备注

- 每个属性测试任务对应设计文档中的一个正确性属性
- 检查点任务用于阶段性验证，确保功能正确后再继续
